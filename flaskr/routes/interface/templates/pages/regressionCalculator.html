{% extends "mainInterface.html" %}

{% block css %}
<link
rel="stylesheet"
type="text/css"
href="{{ url_for('interface_bp.static', filename='css/regressionCalculator.css') }}"
/>  
{% endblock css %}

{% block scripts %}
<script 
    src="{{ url_for('interface_bp.static', filename='javascript/regressionCalculator.js')}}" 
    type="text/javascript">
</script>
{% endblock scripts %}

{% block content %}
<div class="container">
    <div class="row text-center my-4 mytitle" >
        <h1>Regression Model Calculator</h1>
    </div>
    <div class="row">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>    
    <div class="row">
        <div class="col-md-6 border border-secondary rounded">
            <h1>Calculation settings</h1>
            <div class="form-section">
                <form id="uploadForm" action="" method="post" enctype="multipart/form-data" autocomplete="off">
                    {{ form.hidden_tag() }}
                    
                    <div class="form-group">
                        {{ form.model_dir.label(class="form-control-label text-bold")}}
                        <div class="input-group">
                            {{ form.model_dir(class="form-control", placeholder="Type a new folder name or select an existing folder") }}
                            <div class="input-group-append">
                                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Select</button>

                                <ul class="dropdown-menu">
                                    {% for dir in model_dirs %}
                                        <li><a class="dropdown-item" onclick="selectModelDir('{{ dir }}')">{{ dir }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        {{ form.file_input.label(class="form-control-label text-bold")}}                     
                        <div class="custom-file">
                            {% if form.file_input.errors %}
                                {{ form.file_input(class="custom-file-input form-control is-invalid", onchange="updateFileInput()") }}
                                <label class="custom-file-label" for="file_input">{{form.file_input.description}}</label>
                                <div class="invalid-feedback">
                                    {% for error in form.file_input.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                    </div>
                            {% else %}
                                {{ form.file_input(class="custom-file-input form-control", onchange="updateFileInput()") }}
                                <label class="custom-file-label" for="file_input">{{form.file_input.description}}</label>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        {{ form.files_output.label(class="form-control-label text-bold")}}
                        <div id="container_field_files_output" class="custom-file">
                            {% if form.files_output.errors %}
                                {{ form.files_output(class="custom-file-input form-control is-invalid", onchange="updateFilesOutput()") }}
                                <label id="label_field_files_output" class="custom-file-label fit-content" for="files_output">{{form.files_output.description}}</label>
                                <div class="invalid-feedback">
                                    {% for error in form.files_output.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                    </div>
                            {% else %}
                                {{ form.files_output(class="custom-file-input form-control", onchange="updateFilesOutput()") }}
                                <label id="label_field_files_output" class="custom-file-label fit-content" for="files_output">{{form.files_output.description}}</label>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        {{ form.window.label(class="form-control-label text-bold")}}
                        <div class="input-group">
                            {% if form.window.errors %}
                                {{ form.window(placeholder="Enter a integer value from 0", class="form-control is-invalid") }}
                                <div class="input-group-append">
                                    
                                </div>
                                <div class="invalid-feedback">
                                    {% for error in form.window.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                    </div>
                            {% else %}
                                {{ form.window(placeholder="Enter a integer value from 0", class="form-control") }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="form-group">
                        {{ form.modelname.label(class="form-control-label text-bold")}}
                        <label class="form-control-label text-a-bit-bold" for="modelname">{{form.modelname.description}}</label>
                        {{ form.modelname(placeholder="Type the name of result file", class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.test.label(class="form-control-label text-bold")}}
                        {{ form.test() }}
                    </div>
                    <div class="form-group">
                        {{ form.submit(class="btn btn-primary", onclick="showProcessing()") }}
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-6 border border-secondary rounded">
            <h1>Result</h1>            
            <!--                
            <button type="button" name="age" id="age" data-toggle="modal" data-target="#add_data_Modal" class="btn btn-secondary">Broker Config</button>
            <div id="add_data_Modal" class="modal fade">
                <div class="modal-dialog">  
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Broker Config</h4>
                        </div>
                        <div class="modal-body" align="left">
                            <label>Host Name</label>
                            <input type="text" name="host_name" id="host_name" class="form-control" />
                            <br />
                            <label>Host Password</label>
                            <input type="password" name="password" id="password" class="form-control" />
                            <br />
                            <label>Broker IP</label>
                            <input type="text" name="IP" id="IP" class="form-control" />
                            <br />  
                            <label>Nome topic</label>
                            <input type="text" name="topic" id="topic" class="form-control" />
                            <br />  
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            -->
            <div id="before_result">
                <br>
                <br>
                <br>
                <h3>Started processing.</h3>
                <h3>This may take some minutes.</h3>
            </div>
            <div id="result_real">              
                <div>
                    <textarea name="result" id="result_regression" cols="40" rows="8">{{ string }}</textarea>
                </div> <!-- New div to display the generated string --> 
                <br>
                <h4 id="text_result"></h4>  
                <br>   
                <div id="buttons_result">
                    <a class="btn btn-info" href="{{ url_for('interface_bp.file_manager') }}">Go to file manager to download or delete</a>
                    <!--
                    <button type="button" id="actionButton" onclick="handleAction('save', event)" class="btn btn-success">Save</button>
                    <button type="button" id="actionButton" onclick="handleAction('delete', event)" class="btn btn-danger">Delete</button>
                    -->
                </div>
            </div>
        </div>
    </div>
{% endblock %}